æ˜ç™½äº†ï¼ä»¥ä¸‹æ˜¯ä½ æä¾›çš„ Markdown ç­†è¨˜çš„æ½¤è‰²ç‰ˆæœ¬ï¼Œä¿æŒåŸæ„ä¸è®Šï¼Œåƒ…æå‡èªè¨€è¡¨é”ã€æ ¼å¼æ¸…æ™°åº¦èˆ‡é‚è¼¯çµæ§‹ï¼š

---

### 1. ä¿®æ”¹çª—å£æ ·å¼ä¸ºæ— è¾¹æ¡†

æ‰“å¼€æ–‡ä»¶è·¯å¾„ï¼š
`flutter_application_1\windows\runner\win32_window.cpp`

å°† `CreateWindow` å‡½æ•°ä¸­çª—å£æ ·å¼çš„å‚æ•°ä¿®æ”¹ä¸ºä»¥ä¸‹å€¼ï¼Œä»¥å®ç°æ— è¾¹æ¡†çª—å£æ•ˆæœï¼š

```cpp
WS_POPUP | WS_THICKFRAME | WS_MINIMIZEBOX | WS_MAXIMIZEBOX | WS_SYSMENU
```

è¿™æ ·å¯ä»¥ç§»é™¤é»˜è®¤çš„çª—å£è¾¹æ¡†ï¼Œä½†ä»ä¿ç•™åŸºæœ¬çš„çª—å£æ“ä½œåŠŸèƒ½ï¼ˆå¦‚æœ€å¤§åŒ–ã€æœ€å°åŒ–ã€ç³»ç»Ÿèœå•ç­‰ï¼‰ã€‚

---

### 2. å°†å†…å®¹æ‰©å±•åˆ°æ ‡é¢˜æ 

åŒæ ·åœ¨ [win32_window.cpp](file://c:\Users\123\Desktop\SelfDrawTitle\flutter_application_1\windows\runner\win32_window.cpp) æ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ° `Win32Window::MessageHandler` å‡½æ•°ä¸­çš„ `switch (message)` è¯­å¥å—ï¼Œæ·»åŠ å¯¹ `WM_NCCALCSIZE` æ¶ˆæ¯çš„å¤„ç†é€»è¾‘å¦‚ä¸‹ï¼š

```cpp
case WM_NCCALCSIZE: {
  if (wParam == TRUE) {
    // è¿”å› 0 å‘Šè¯‰ Windowsï¼šå®¢æˆ·åŒºå°†å æ®æ•´ä¸ªçª—å£åŒºåŸŸ
    return 0;
  }
  break;
}
```

æ­¤æ®µä»£ç çš„ä½œç”¨æ˜¯é˜»æ­¢ç³»ç»Ÿå¯¹éå®¢æˆ·åŒºï¼ˆæ ‡é¢˜æ ã€è¾¹æ¡†ç­‰ï¼‰è¿›è¡Œé»˜è®¤å¸ƒå±€è®¡ç®—ï¼Œå¹¶è®©å®¢æˆ·åŒºå†…å®¹è¦†ç›–æ•´ä¸ªçª—å£åŒºåŸŸï¼Œä»è€Œå®ç°å†…å®¹å»¶ä¼¸è‡³æ ‡é¢˜æ çš„æ•ˆæœã€‚

---

### 3. åŸç”Ÿé€šä¿¡å®ç°

æ‰“å¼€æ–‡ä»¶è·¯å¾„ï¼š
`flutter_application_1\windows\runner\flutter_window.cpp`

åœ¨åˆé€‚çš„ä½ç½®æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªæ–¹æ³•é€šé“å¹¶æ³¨å†ŒåŸç”Ÿæ–¹æ³•ï¼š

```cpp
flutter::MethodChannel<> channel(
    flutter_controller_->engine()->messenger(), "samples.flutter.dev/battery",
    &flutter::StandardMethodCodec::GetInstance());
channel.SetMethodCallHandler(
    [](const flutter::MethodCall<>& call,
        std::unique_ptr<flutter::MethodResult<>> result) {
        if (call.method_name() == "getBatteryLevel") {
            int battery_level = SendWinZ();
            if (battery_level != -1) {
                result->Success(battery_level);
            } else {
                result->Error("UNAVAILABLE", "Battery level not available.");
            }
        } else {
            result->NotImplemented();
        }
    });
```

å¹¶åœ¨ä¸‹æ–¹å®ç° `SendWinZ()` æ–¹æ³•ï¼Œæ¨¡æ‹ŸæŒ‰ä¸‹ Win+Z å¿«æ·é”®ï¼š

```cpp
static int SendWinZ() {
  // æŒ‰ä¸‹ Win é”®
  keybd_event(VK_LWIN, 0, 0, 0);

  // æŒ‰ä¸‹ Z é”®
  keybd_event('Z', 0, 0, 0);

  // é‡Šæ”¾ Z é”®
  keybd_event('Z', 0, KEYEVENTF_KEYUP, 0);

  // é‡Šæ”¾ Win é”®
  keybd_event(VK_LWIN, 0, KEYEVENTF_KEYUP, 0);

  return 1;
}
```

---

#### åœ¨ Flutter å±‚æ³¨å†Œæ–¹æ³•é€šé“

æ‰“å¼€ `main.dart` æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ä»¥æ³¨å†Œæ–¹æ³•é€šé“å¹¶è°ƒç”¨åŸç”Ÿæ–¹æ³•ï¼š

```dart
static const platform = MethodChannel('samples.flutter.dev/battery');
String _batteryLevel = 'Unknown battery level.';

Future<void> _getBatteryLevel() async {
  String batteryLevel;
  try {
    final result = await platform.invokeMethod<int>('getBatteryLevel');
    batteryLevel = 'Battery level at $result%.';
  } on PlatformException catch (e) {
    batteryLevel = "Failed to get battery level: '${e.message}'.";
  }

  setState(() {
    _batteryLevel = batteryLevel;
  });
}
```

#### åœ¨æŒ‰é’®ä¸­è°ƒç”¨è¯¥æ–¹æ³•

åœ¨ UI ä¸­æ·»åŠ ä¸€ä¸ªæŒ‰é’®æ¥è§¦å‘åŸç”Ÿæ–¹æ³•è°ƒç”¨ï¼š

```dart
TextButton(
  style: TextButton.styleFrom(
    foregroundColor: Colors.black,
    padding: const EdgeInsets.symmetric(horizontal: 16.0),
  ),
  onPressed: _getBatteryLevel,
  child: const Text('ğŸ—–', style: TextStyle(fontSize: 18)),
),
```

---

å¦‚éœ€è¿›ä¸€æ­¥ç¾åŒ–æ ‡é¢˜æ æˆ–å®Œå–„åŸç”Ÿäº¤äº’åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ç»§ç»­è¡¥å……ç›¸å…³å®ç°ç»†èŠ‚ã€‚æ˜¯å¦éœ€è¦æˆ‘å¸®ä½ æ•´ç†æˆæ›´å®Œæ•´çš„å¼€å‘æ–‡æ¡£æ ¼å¼ï¼Ÿ